
<!DOCTYPE html>
<html>
<head><title>Dashboard</title>
  
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body class="bg-light">
<div class="container mt-4">
  <h3>Welcome, {{ user.email }}</h3>
  <a href="{{ url_for('logout') }}" class="btn btn-danger float-end">Logout</a>
  {% if user.role == 'Owner' %}
    <a href="{{ url_for('admin') }}" class="btn btn-outline-primary float-end me-2">Admin Panel</a>
  {% endif %}
  <div class="clearfix mb-4"></div>
<div class="progress mb-2">
  <div id="uploadProgress" class="progress-bar" style="width: 0%;">0%</div>
</div>

  <form id="uploadFilesForm" method="POST" action="{{ url_for('upload_files') }}" enctype="multipart/form-data">
    <input type="hidden" name="folder" value="{{ prefix }}" />
    <div class="mb-3">
      <input class="form-control" type="file" name="files" id="files" multiple />
    </div>
    <button type="submit" class="btn btn-primary">Upload Files</button>
  </form>

  <form id="uploadFolderForm" method="POST" action="{{ url_for('upload_folder') }}" enctype="multipart/form-data" class="mt-3">
    <input type="hidden" name="folder" value="{{ prefix }}" />
    <div class="mb-3">
      <input class="form-control" type="file" name="folder_files" id="folderFiles" webkitdirectory directory multiple />
    </div>
    <button type="submit" class="btn btn-primary">Upload Folder</button>
  </form>

  <h4 class="mt-4">Folders</h4>
  {% for folder in folders %}
  <li class="list-group-item d-flex justify-content-between align-items-center">
    <a href="{{ url_for('dashboard', folder=prefix + folder + '/') }}">üìÅ {{ folder }}</a>
    {% if user.role == 'Owner' %}
      <a href="{{ url_for('share_folder', folder=prefix + folder + '/') }}" class="btn btn-sm btn-warning">Share</a>
    {% endif %}
  </li>
{% endfor %}

  </ul>

  <h4 class="mt-4">Files</h4>
  <ul class="list-group">
    {% for file in files %}
      <li class="list-group-item d-flex justify-content-between align-items-center">
        {{ file.name }}
        <a href="{{ url_for('download', file=file.full_path) }}" class="btn btn-sm btn-secondary">Download</a>
      </li>
    {% else %}
      <li class="list-group-item">No files found</li>
    {% endfor %}
  </ul>
</div>
<script>
document.addEventListener('DOMContentLoaded', function () {
  const uploadForm = document.getElementById('uploadFilesForm');
  const uploadProgress = document.getElementById('uploadProgress');

  if (uploadForm && uploadProgress) {
    uploadForm.addEventListener('submit', function (e) {
      e.preventDefault();

      const formData = new FormData(uploadForm);
      const xhr = new XMLHttpRequest();
      xhr.open('POST', uploadForm.action);

      xhr.upload.addEventListener('progress', function (e) {
        if (e.lengthComputable) {
          const percent = Math.round((e.loaded / e.total) * 100);
          uploadProgress.style.width = percent + '%';
          uploadProgress.textContent = percent + '%';
        }
      });

      xhr.onload = function () {
        if (xhr.status === 200 || xhr.status === 204) {
          uploadProgress.classList.add('bg-success');
          uploadProgress.textContent = 'Upload Complete!';
          setTimeout(() => window.location.reload(), 1000);
        } else {
          alert('Upload failed.');
        }
      };

      xhr.send(formData);
    });
  }
});
</script>
{% if shared_roots %}
  <h4 class="mt-5">Shared With Me</h4>
  <ul class="list-group">
    {% for path in shared_roots %}
    <li class="list-group-item d-flex justify-content-between align-items-center">
      <a href="{{ url_for('dashboard', folder=path) }}">{{ path }}</a>
    </li>
    {% endfor %}
  </ul>
{% endif %}

</body>
</html>
